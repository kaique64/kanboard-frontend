<template>
    <Board v-for="board in boards" :board="board" :key="board.id">
      <template #content>
        <Container 
          :group-name="groupName" 
          @drag-start="dragAndDropService.handleDragStart(board.id, $event)" 
          @drop="dragAndDropService.handleDrop(board.id, $event)"
          :get-child-payload="getChildPayload"
          :drop-placeholder="{ className: 'placeholder' }"
        >
          <Draggable v-for="task in board.tasks" :key="task.id">
            <Card class="q-my-sm rounded-borders" style="background-color: rgb(234, 234, 234);">
                <template #content>
                  <Task :name="task.name" :description="task.description" />
                  <div class="row justify-start items-center q-mt-xs">
                    <Button id="update-task" flat size="md" color="blue" class="q-mr-xs" icon="mdi-pencil-outline">
                      <template #default>
                        <q-tooltip class="text-capitalize">Update task</q-tooltip>
                      </template>
                    </Button>
                    <Button id="delete-task" flat size="md" color="red" icon="mdi-trash-can-outline">
                      <template #default>
                        <q-tooltip class="text-capitalize">Delete task</q-tooltip>
                      </template>
                    </Button>
                  </div>
                </template>
            </Card>
          </Draggable>
        </Container>
      </template>
    </Board>
</template>

<script setup lang="ts">
import { ref, onBeforeMount, computed } from 'vue';
import { Container, Draggable } from "vue3-smooth-dnd";
import { DragAndDropService } from '../service/DragAndDropService'
import Board from '../../board/component/Board.vue'
import Card from '../../../common/component/card/Card.vue'
import BoardStore from '../../board/store/BoardStore';
import Task from '../../task/component/Task.vue'
import Button from '../../../common/component/button/Button.vue';

interface IProps {
    groupName: string;
}

const props = defineProps<IProps>();
const groupName = ref(props.groupName);
const boardStore = BoardStore();
const boards = computed(() => boardStore.getBoards());
const dragAndDropService = DragAndDropService();

function getChildPayload(index: number) {
  return {
    index
  }
}

onBeforeMount(async () => {
	boardStore.getBoards().length === 0 && await boardStore.fetchBoard();
});
</script>
